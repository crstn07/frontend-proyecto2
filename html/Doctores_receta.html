<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doctores | Recetas</title>
    <link rel="shortcut icon" href="../images/logo.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" />
</head>

<body onload="ObtenerUsuario()">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary animate__animated animate__slideInDown">
        <div class="container-fluid ">
            <img src="../images/logo2.png" style=max-width:65px;width:auto;height:auto;margin-right:10px;>
            <a class="navbar-brand" href="#">UHospital - Médico</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="Doctores_receta.html">Recetas</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="Doctores.html">Citas</a>
                    </li>
                </ul>
                <p id="Nombre" class="text-white" style="position:relative; margin-right: 0.5%; top:7px; "> </p>
                <p class="text-white" style="position:relative; margin-right: 1%; top:7px;" class="text-white"
                    id="Apellido"> </p>
                <button onclick="LLenarFormDatos()" style="margin-right: 1%;" type="button" class="btn btn-warning"
                    data-bs-toggle="modal" data-bs-target="#ModalModificacion">
                    <svg xmlns="http://www.w3.org/2000/svg" width="19" height="19" fill="currentColor"
                        class="bi bi-gear" viewBox="0 0 16 16">
                        <path
                            d="M8 4.754a3.246 3.246 0 1 0 0 6.492 3.246 3.246 0 0 0 0-6.492zM5.754 8a2.246 2.246 0 1 1 4.492 0 2.246 2.246 0 0 1-4.492 0z" />
                        <path
                            d="M9.796 1.343c-.527-1.79-3.065-1.79-3.592 0l-.094.319a.873.873 0 0 1-1.255.52l-.292-.16c-1.64-.892-3.433.902-2.54 2.541l.159.292a.873.873 0 0 1-.52 1.255l-.319.094c-1.79.527-1.79 3.065 0 3.592l.319.094a.873.873 0 0 1 .52 1.255l-.16.292c-.892 1.64.901 3.434 2.541 2.54l.292-.159a.873.873 0 0 1 1.255.52l.094.319c.527 1.79 3.065 1.79 3.592 0l.094-.319a.873.873 0 0 1 1.255-.52l.292.16c1.64.893 3.434-.902 2.54-2.541l-.159-.292a.873.873 0 0 1 .52-1.255l.319-.094c1.79-.527 1.79-3.065 0-3.592l-.319-.094a.873.873 0 0 1-.52-1.255l.16-.292c.893-1.64-.902-3.433-2.541-2.54l-.292.159a.873.873 0 0 1-1.255-.52l-.094-.319zm-2.633.283c.246-.835 1.428-.835 1.674 0l.094.319a1.873 1.873 0 0 0 2.693 1.115l.291-.16c.764-.415 1.6.42 1.184 1.185l-.159.292a1.873 1.873 0 0 0 1.116 2.692l.318.094c.835.246.835 1.428 0 1.674l-.319.094a1.873 1.873 0 0 0-1.115 2.693l.16.291c.415.764-.42 1.6-1.185 1.184l-.291-.159a1.873 1.873 0 0 0-2.693 1.116l-.094.318c-.246.835-1.428.835-1.674 0l-.094-.319a1.873 1.873 0 0 0-2.692-1.115l-.292.16c-.764.415-1.6-.42-1.184-1.185l.159-.291A1.873 1.873 0 0 0 1.945 8.93l-.319-.094c-.835-.246-.835-1.428 0-1.674l.319-.094A1.873 1.873 0 0 0 3.06 4.377l-.16-.292c-.415-.764.42-1.6 1.185-1.184l.292.159a1.873 1.873 0 0 0 2.692-1.115l.094-.319z" />
                    </svg>
                </button>
                <a href="Login.html">
                    <button onclick="localStorage.clear()" type="button" class="btn btn-danger">
                        Cerrar Sesión
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                            class="bi bi-box-arrow-right" viewBox="0 0 16 16">
                            <path fill-rule="evenodd"
                                d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z" />
                            <path fill-rule="evenodd"
                                d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z" />
                        </svg>
                    </button>
                </a>
            </div>
        </div>
    </nav>
    <div class="modal fade" id="ModalModificacion" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
        aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="tituloModalModificar"> Modificar Perfil</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body" id="bodyModalModificar">
                    <form id="form" class="row g-3 needs-validation " novalidate
                        style="position: relative; width:90%; left: 10%;">
                        <div class="col-md-5">
                            <label for="nombre" class="form-label">Nombre</label>
                            <input type="text" class="form-control" placeholder="Ingrese un nombre" id="nombre"
                                required>
                            <div class="invalid-feedback">
                                Por favor ingrese un nombre.
                            </div>
                        </div>
                        <div class="col-md-5">
                            <label for="apellido" class="form-label">Apellido</label>
                            <input type="text" class="form-control" id="apellido" placeholder="Ingrese un apellido"
                                required>
                            <div class="invalid-feedback">
                                Por favor ingrese un apellido.
                            </div>
                        </div>
                        <div class="col-md-5">
                            <label for="fecha" class="form-label">Fecha de Nacimiento</label>
                            <input type="date" class="form-control" id="fecha" required>
                            <div class="invalid-feedback">
                                Por favor escoja una fecha.
                            </div>
                        </div>
                        <div class="col-md-5">
                            <label for="sexo" class="form-label">Sexo</label>
                            <select class="form-select" id="sexo" required>
                                <option selected disabled value="">Escoger...</option>
                                <option>M</option>
                                <option>F</option>
                            </select>
                            <div class="invalid-feedback">
                                Por favor seleccione una opción válida.
                            </div>
                        </div>
                        <div class="col-md-5">
                            <label for="telefono" class="form-label">Teléfono </label>
                            <input type="number" class="form-control" id="telefono"
                                placeholder="Ingrese un número de teléfono">
                        </div>
                        <div id="div_especialidad" class="col-md-5 ">
                            <label for="Especialidad" class="form-label">Especialidad</label>
                            <input type="text" class="form-control" placeholder="Ingrese una especialidad"
                                id="especialidad" required>
                            <div class="invalid-feedback">
                                Por favor ingrese una especialidad.
                            </div>
                        </div>
                        <div class="col-md-5">
                            <label for="usuario" class="form-label">Nombre de Usuario</label>
                            <div class="input-group has-validation">
                                <input type="text" class="form-control" placeholder="Ingrese un nombre de usuario"
                                    id="usuario" aria-describedby="inputGroupPrepend" required>
                                <div class="invalid-feedback">
                                    Por favor ingrese un nombre de usuario.
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5 ">
                            <label for="contraseña" class="form-label">Contraseña</label>
                            <input type="password" class="form-control" placeholder="Ingrese una contraseña"
                                id="contraseña" required>
                            <div class="invalid-feedback">
                                Por favor ingrese una contraseña.
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button id="botonModal" onclick="ModificarPerfil(this)" type="button"
                        class="btn btn-primary">Modificar</button>
                </div>
            </div>
        </div>
    </div>
    <div class=" container-sm" style="margin-top: 50px; margin-bottom: 30px;">
        <form id="formReceta" class="row g-3 needs-validation " novalidate
            style="position: relative; width:90%; left: 10%;">
            <div class="col-md-5">
                <label for="fechaFactura" class="form-label">Fecha </label>
                <input type="date" class="form-control" id="fechaFactura" required>
                <div class="invalid-feedback">
                    Por favor escoja una fecha.
                </div>
            </div>
            <div class="col-md-5">
                <label for="nombreReceta" class="form-label">Nombre del Paciente</label>
                <input type="text" class="form-control" placeholder="Ingrese el nombre del paciente" id="nombreReceta"
                    required>
                <div class="invalid-feedback">
                    Por favor ingrese un nombre.
                </div>
            </div>
            <div class="col-md-5">
                <label for="padecimiento" class="form-label">Padecimiento</label>
                <input type="text" class="form-control" id="padecimiento" placeholder="Ingrese el padecimiento"
                    required>
                <div class="invalid-feedback">
                    Por favor ingrese el padecimiento.
                </div>
            </div>
            <div class="col-md-5">
                <label for="descripcion" class="form-label">Descripción</label>
                <textarea style="height: 100px;" type="textarea" class="form-control" id="descripcion"
                    placeholder="Ingrese una descripción para la receta" required></textarea>
                <div class="invalid-feedback">
                    Por favor ingrese una descripción.
                </div>
            </div>
            <div class="col-12">
                <button class="btn btn-success" style="width: 15%; position:relative; left: 68%;" type="button"
                    onclick="generarReceta()">Generar Receta</button>
            </div>
        </form>
    </div>
    Lorem, ipsum dolor sit amet consectetur adipisicing elit. Facere, ipsa! Vitae, distinctio? Ipsa id, quidem velit
    autem iure laborum optio, saepe ullam porro blanditiis laudantium maiores! Culpa quia laborum odit.
    <script>
        var nombre, apellido, fecha, sexo, Usuario, contraseña, telefono, especialidad
        function ObtenerUsuario() {
            var usuario_log = localStorage.logueado
            fetch(`https://backend-proyecto2-202010893.herokuapp.com/Medico/${usuario_log}`, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                    'Access-Control-Allow-Origin': '*',
                }
            })
                .then(res => res.json())
                .catch(err => {
                    console.error('Error:', err)
                    alert("Ocurrio un error, ver la consola")
                })
                .then(response => {
                    console.log(response)
                    var texto1 = document.querySelector('#Nombre')
                    var texto2 = document.querySelector('#Apellido')
                    nombre = response.Nombre
                    apellido = response.Apellido
                    fecha = response.Fecha
                    sexo = response.Sexo
                    Usuario = response.Usuario
                    contraseña = response.Contraseña
                    telefono = response.Teléfono
                    especialidad = response.Especialidad
                    texto1.innerHTML = nombre
                    texto2.innerHTML = apellido
                })
        }

        function LLenarFormDatos() {
            document.querySelector('#nombre').value = nombre
            document.querySelector('#apellido').value = apellido
            document.querySelector('#fecha').value = fecha
            document.querySelector('#sexo').value = sexo
            document.querySelector('#usuario').value = Usuario
            document.querySelector('#contraseña').value = contraseña
            document.querySelector('#telefono').value = telefono
            document.querySelector('#especialidad').value = especialidad
        }

        function ModificarPerfil(button) {
            var nombre = document.querySelector('#nombre').value
            var apellido = document.querySelector('#apellido').value
            var usuario = document.querySelector('#usuario').value
            var contraseña = document.querySelector('#contraseña').value
            var telefono = document.querySelector('#telefono').value
            var fechaNacimiento = document.querySelector('#fecha').value
            var sexo = document.querySelector('#sexo').value
            var especialidad = document.querySelector('#especialidad').value
            if ((nombre && apellido && usuario && contraseña && fechaNacimiento && sexo && especialidad) != "") {
                var nuevoPerfil = {
                    'Nombre': nombre,
                    'Apellido': apellido,
                    'Fecha': fechaNacimiento,
                    'Sexo': sexo,
                    'Teléfono': telefono,
                    'Usuario': usuario,
                    'Contraseña': contraseña,
                    'Especialidad': especialidad
                }
                console.log(nuevoPerfil)

                fetch(`https://backend-proyecto2-202010893.herokuapp.com/Medico/${Usuario}`, {
                    method: 'PUT',
                    body: JSON.stringify(nuevoPerfil),
                    headers: {
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*',
                    }
                })
                    .then(res => res.json())
                    .catch(err => {
                        console.error('Error:', err)
                        alert("Ocurrio un error, ver la consola")
                    })
                    .then(response => {
                        console.log(response);
                        alert(response.Mensaje)
                        if (response.Mensaje == "Se actualizó correctamente") {
                            localStorage.clear()
                            localStorage.logueado = usuario
                            location.reload()
                        }
                    })
            } else {
                var form = document.querySelector('#form')
                form.classList.add('was-validated')
            }
        }

        function generarReceta() {
            var nombre = document.querySelector('#nombreReceta').value
            var fecha = document.querySelector('#fechaFactura').value
            var padecimiento = document.querySelector('#padecimiento').value
            var descripcion = document.querySelector('#descripcion').value
            if ((nombre && fecha && padecimiento && descripcion) != "") {
                var datos = `
                <!DOCTYPE html>
                <html lang="es">

                <head>
                    <meta charset="UTF-8">
                    <title> Receta </title>
                    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet"
                        integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
                </head>

                <body >
                    <div>
                        <img style="float: left;" src="../images/logo2.png" width="100px" height="100px">  
                        <h1 style="position:relative; left: 10px; top: 25px;" class="display-5 fw-normal">
                            UHospital 
                    </h1>
                    </div>
                    <div style="position: absolute; left: 10px; top: 120px;">
                    
                    <p class="fs-5 lh-1" > 8a. Avenida 13-76, Zona 15 , Guatemala </p>
                    <p class="fs-5 lh-1"> Teléfono:  PBX. +502 22001045 </p>
                    </div>
                    <div  style="position: absolute; right: 10px; top: 100px;">
                    <p class="fs-5 lh-1" > <b>Fecha:</b> ${fecha} </p>
                    </div>
                    <div  style="position: absolute; left: 10px; top: 230px;">
                    <p class="fs-5 lh-1" > RECETADO A: </p>
                    <p class="fs-5 lh-1"> ${nombre} </p>
                    </div>
                    <h1 class="display-3 fw-bolder" style="position: absolute; right: 10px; top: 5px;">
                        Receta
                    </h1>
                
                    <div style="position: absolute; width: 98%; left: 1%; top: 330px; ">
                        <p class="fs-5 fw-bolder"> Padecimiento: %{padecimiento} </p> 
                    <p class="fs-5 "> Descripción:  </p>
                    <p class="fs-6 fst-italic"> ${descripcion} </p>
                    </div>
                </body>

                </html>
                `
                enfermedad = {
                    'Enfermedad': padecimiento
                }
                fetch(`https://backend-proyecto2-202010893.herokuapp.com/Enfermedades`, {
                    method: 'POST',
                    body: JSON.stringify(enfermedad),
                    headers: {
                        'Content-Type': 'application/json',
                        'Access-Control-Allow-Origin': '*',
                    }
                })
                    .then(res => res.json())
                    .catch(err => {
                        console.error('Error:', err)
                        alert("Ocurrio un error, ver la consola")
                    })
                    .then(response => {
                        console.log(response);
                        alert(response.Mensaje)
                    })

                var win = window.open('', '', 'height=700,width=700');
                win.document.write(datos);
                win.document.close();
                setTimeout(() => { win.print(); }, 500);
                location.reload

            } else {
                var form = document.querySelector('#formReceta')
                form.classList.add('was-validated')
            }
        }
    </script>
</body>

</html>